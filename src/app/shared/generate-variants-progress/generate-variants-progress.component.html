<h2 mat-dialog-title>
  <mat-icon>auto_awesome</mat-icon>
  {{ data.pointName === 'Point Brief Draft' ? 'Drafting your optimization briefâ€¦' : (data.pointName === 'Brief Generation' ? 'Generating Draft Brief' : 'Generating Variants') }}
</h2>

<mat-dialog-content>
  <div class="progress-container" *ngIf="!isComplete && !error">
    <!-- Progress Bar -->
    <div class="progress-section">
      <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
      <div class="progress-text">{{ Math.round(progress) }}%</div>
    </div>

    <!-- Status Message -->
    <div class="status-message">
      <p>{{ currentMessage }}</p>
      <p class="time-note" *ngIf="progress < 90">This can take up to ~60 seconds</p>
    </div>

    <!-- Steps List -->
    <div class="steps-list">
      <div 
        *ngFor="let step of steps" 
        class="step-item"
        [class.pending]="step.status === 'pending'"
        [class.in-progress]="step.status === 'in-progress'"
        [class.done]="step.status === 'done'">
        <mat-icon class="step-icon">
          <span *ngIf="step.status === 'pending'">radio_button_unchecked</span>
          <span *ngIf="step.status === 'in-progress'">
            <span class="spinner">autorenew</span>
          </span>
          <span *ngIf="step.status === 'done'">check_circle</span>
        </mat-icon>
        <span class="step-label">{{ step.label }}</span>
      </div>
    </div>
  </div>

  <!-- Success State -->
  <div class="success-container" *ngIf="isComplete && !error">
    <div class="success-icon">
      <mat-icon>check_circle</mat-icon>
    </div>
    <h3>Done</h3>
    <p class="success-message" *ngIf="data.pointName === 'Point Brief Draft'">Draft applied. You can review and edit the fields below.</p>
    <p class="success-message" *ngIf="data.pointName === 'Brief Generation'">Draft brief generated successfully</p>
    <p class="success-message" *ngIf="data.pointName !== 'Brief Generation' && data.pointName !== 'Point Brief Draft'">{{ variantCount }} variants generated</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error">
    <div class="error-icon">
      <mat-icon>error</mat-icon>
    </div>
    <h3>{{ data.pointName === 'Point Brief Draft' ? 'Draft Failed' : (data.pointName === 'Brief Generation' ? 'Brief Generation Failed' : 'Generation Failed') }}</h3>
    <p class="error-message">{{ error }}</p>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onClose()" *ngIf="!isComplete && !error">
    Cancel
  </button>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="onReviewVariants()" 
    *ngIf="isComplete && !error && data.pointName !== 'Brief Generation' && data.pointName !== 'Point Brief Draft'">
    <mat-icon>visibility</mat-icon>
    Review Variants
  </button>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="onClose()" 
    *ngIf="isComplete && !error && (data.pointName === 'Brief Generation' || data.pointName === 'Point Brief Draft')">
    <mat-icon>check</mat-icon>
    Close
  </button>
  <button 
    mat-button 
    (click)="onRetry()" 
    *ngIf="error">
    <mat-icon>refresh</mat-icon>
    Retry
  </button>
  <button 
    mat-button 
    (click)="onGenerateFallback()" 
    *ngIf="error && data.pointName !== 'Point Brief Draft'">
    <mat-icon>settings_backup_restore</mat-icon>
    {{ data.pointName === 'Brief Generation' ? 'Generate Fallback Brief' : 'Generate Fallback Variants' }}
  </button>
</mat-dialog-actions>
