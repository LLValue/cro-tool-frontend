<app-page-header
  title="Preview"
  description="Preview the target page with selected variants applied to validate the experience before activation.">
  <button mat-raised-button color="primary" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
    Back to Reporting
  </button>
</app-page-header>

<div class="preview-container">
  <div class="preview-content" [class.loading]="loadingPreview">
    <div class="loading-overlay" *ngIf="loadingPreview">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      <p>Loading page preview...</p>
    </div>
    <iframe 
      *ngIf="useIframe && safeIframeHtml && !loadingPreview" 
      [srcdoc]="safeIframeHtml" 
      class="preview-iframe"
      tabindex="-1"
      aria-hidden="true"
      (load)="onPreviewIframeLoad()"
      frameborder="0">
    </iframe>
    <iframe 
      *ngIf="useIframe && safeIframeUrl && !safeIframeHtml && !loadingPreview" 
      [src]="safeIframeUrl" 
      class="preview-iframe"
      tabindex="-1"
      aria-hidden="true"
      (load)="onPreviewIframeLoad()"
      frameborder="0">
    </iframe>
    <div 
      *ngIf="!useIframe && !loadingPreview" 
      class="preview-wrapper" 
      [innerHTML]="safePreviewHtml">
    </div>
  </div>
  <div class="variants-panel">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Applied Variants</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list>
          <mat-list-item *ngFor="let variant of appliedVariants">
            <div class="variant-item">
              <strong>{{ getPointName(variant.optimizationPointId) }}</strong>
              <p>{{ variant.text }}</p>
            </div>
          </mat-list-item>
          <mat-list-item *ngIf="appliedVariants.length === 0">
            <p>No variants applied</p>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>
</div>

