<app-page-header
  title="Goals"
  description="Define what success means for this project: one primary goal and any number of secondary goals.">
</app-page-header>

<div class="goals-container">
  <mat-card class="goals-card">
    <mat-card-header>
      <mat-card-title>Goal</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="goalForm">
        <p class="mandatory-note">The mandatory fields are marked with an asterisk <span class="asterisk-red">*</span></p>
        
        <div class="form-field-wrapper">
          <label class="field-label">
            Goal priority
            <span class="required-asterisk">*</span>
          </label>
          <p class="field-helper">Select whether this is a primary or secondary goal.</p>
          <mat-form-field appearance="outline" class="brief-input">
            <mat-select formControlName="isPrimary" required>
              <mat-option [value]="true">Primary</mat-option>
              <mat-option [value]="false">Secondary</mat-option>
            </mat-select>
            <mat-error *ngIf="(goalForm.get('isPrimary')?.touched || formSubmitted) && goalForm.get('isPrimary')?.hasError('required')">
              Goal priority is required
            </mat-error>
            <mat-error *ngIf="goalForm.get('isPrimary')?.hasError('primaryExists')">
              A primary goal already exists. Only one primary goal is allowed.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-field-wrapper">
          <label class="field-label">
            Goal name
            <span class="required-asterisk">*</span>
          </label>
          <p class="field-helper">Give your goal a descriptive name.</p>
          <mat-form-field appearance="outline" class="brief-input">
            <input matInput formControlName="name" required maxlength="500">
            <mat-error *ngIf="(goalForm.get('name')?.touched || formSubmitted) && goalForm.get('name')?.hasError('required')">
              Goal name is required
            </mat-error>
            <mat-hint align="end">
              <span>{{ getCharacterCount('name') }} / 500</span>
            </mat-hint>
          </mat-form-field>
        </div>

        <div class="form-field-wrapper">
          <label class="field-label">
            Goal type
            <span class="required-asterisk">*</span>
          </label>
          <p class="field-helper">Select the type of goal you want to track.</p>
          <mat-form-field appearance="outline" class="brief-input">
            <mat-select formControlName="type" required>
              <mat-option value="urlReached">URL</mat-option>
              <mat-option value="clickSelector">CSS Selector</mat-option>
              <mat-option value="dataLayerEvent">Event Name</mat-option>
            </mat-select>
            <mat-error *ngIf="(goalForm.get('type')?.touched || formSubmitted) && goalForm.get('type')?.hasError('required')">
              Goal type is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-field-wrapper">
          <label class="field-label">
            {{ getValueLabel() }}
            <span class="required-asterisk">*</span>
          </label>
          <p class="field-helper">{{ getValuePlaceholder() }}</p>
          <mat-form-field appearance="outline" class="brief-input">
            <input matInput formControlName="value" required>
            <mat-error *ngIf="(goalForm.get('value')?.touched || formSubmitted) && goalForm.get('value')?.hasError('required')">
              {{ getValueLabel() }} is required
            </mat-error>
          </mat-form-field>
        </div>
      </form>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="saveGoal()" [disabled]="goalForm.invalid">
        Save Goal
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card class="goals-list-card">
    <mat-card-header>
      <mat-card-title>All Goals Overview</mat-card-title>
      <mat-card-subtitle>Complete list of configured goals</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="goals-list">
        <div class="goal-item" *ngFor="let goal of savedGoals; let i = index" [class.primary-goal]="goal.isPrimary" [class.secondary-goal]="!goal.isPrimary">
          <div class="goal-header">
            <div class="goal-header-content">
              <div class="goal-badge" [class.primary]="goal.isPrimary" [class.secondary]="!goal.isPrimary">
                <mat-icon>{{ goal.isPrimary ? 'flag' : 'label' }}</mat-icon>
                <span>{{ goal.isPrimary ? 'Primary' : 'Secondary ' + (i + 1) }}</span>
              </div>
              <div class="goal-type-badge" [class]="'type-' + goal.type">
                {{ getTypeLabel(goal.type) }}
              </div>
            </div>
            <button mat-icon-button (click)="removeGoal(goal.id)" class="delete-button" type="button" matTooltip="Delete goal">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <div class="goal-content">
            <h3 class="goal-name">{{ goal.name || getDefaultGoalName(goal.type, goal.isPrimary) }}</h3>
            <div class="goal-value">
              <mat-icon class="value-icon">{{ getTypeIcon(goal.type) }}</mat-icon>
              <code>{{ goal.value || 'Not set' }}</code>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="savedGoals.length === 0">
          <mat-icon>info</mat-icon>
          <p>No goals configured yet. Add a goal above to get started.</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
