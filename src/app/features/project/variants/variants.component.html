<app-page-header
  title="Variants"
  description="Generate, review, approve, and disable variants for each optimization point.">
  <button mat-raised-button color="primary" (click)="generateVariants()" [disabled]="!selectedPointId">
    <mat-icon>auto_fix_high</mat-icon>
    Generate 10
  </button>
</app-page-header>

<div class="variants-container">
  <div class="points-list">
    <h3>Points</h3>
    <div *ngIf="points.length === 0" class="empty-points">
      <p>No points created yet. Create points in the Points page first.</p>
    </div>
    <mat-card *ngFor="let point of points" 
              class="point-card" 
              [class.selected]="selectedPointId === point.id"
              (click)="selectPoint(point.id)">
      <mat-card-content>
        <strong>{{ point.name }}</strong>
        <p *ngIf="point.text">{{ point.text }}</p>
        <p *ngIf="point.selector"><code>{{ point.selector }}</code></p>
        <p *ngIf="!point.selector" class="no-selector">No selector set</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="variants-list">
    <div class="variants-header">
      <h3>Variants</h3>
      <mat-chip-set>
        <mat-chip (click)="filter = 'all'" [class.selected]="filter === 'all'">All</mat-chip>
        <mat-chip (click)="filter = 'active'" [class.selected]="filter === 'active'">Active</mat-chip>
        <mat-chip (click)="filter = 'pending'" [class.selected]="filter === 'pending'">Pending</mat-chip>
        <mat-chip (click)="filter = 'discarded'" [class.selected]="filter === 'discarded'">Discarded</mat-chip>
      </mat-chip-set>
    </div>

    <div *ngFor="let variant of filteredVariants" class="variant-card">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-form-field appearance="outline" class="variant-text-input">
              <textarea matInput [(ngModel)]="variant.text" (blur)="updateVariant(variant)"></textarea>
            </mat-form-field>
          </mat-card-title>
          <mat-card-subtitle>
            <mat-chip [class]="'status-' + variant.status">{{ variant.status }}</mat-chip>
            <span class="source-badge">{{ variant.source }}</span>
            <span class="date">{{ variant.createdAt | date:'short' }}</span>
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="scores">
            <div class="score-item" (click)="openScoreDialog(variant, 'ux')">
              <strong>UX Score:</strong> {{ variant.uxScore }}/10
              <mat-icon>info</mat-icon>
            </div>
            <div class="score-item" (click)="openScoreDialog(variant, 'compliance')">
              <strong>Compliance:</strong> {{ variant.complianceScore }}/10
              <mat-icon>info</mat-icon>
            </div>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button (click)="approveVariant(variant.id)" *ngIf="variant.status !== 'active'">
            <mat-icon>check_circle</mat-icon>
            Approve
          </button>
          <button mat-button (click)="unapproveVariant(variant.id)" *ngIf="variant.status === 'active'">
            <mat-icon>remove_circle</mat-icon>
            Disable
          </button>
          <button mat-button color="primary" (click)="deleteVariant(variant.id)">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>

